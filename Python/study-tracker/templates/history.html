<!DOCTYPE html>
<html>
<head>
    <title>Study Tracker - History</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #f0f8ff; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .completion { background: #d4edda; padding: 10px; margin: 5px 0; border-radius: 3px; }
        .review-completion { background: #fff3cd; padding: 10px; margin: 5px 0; border-radius: 3px; }
        .nav { margin-bottom: 20px; }
        .nav a { margin-right: 15px; text-decoration: none; color: #007bff; }
        .nav a:hover { text-decoration: underline; }
        .stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat { background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; flex: 1; }
        .stat-number { font-size: 2em; font-weight: bold; color: #007bff; }
        .rating { color: #666; }
        .notes { font-style: italic; color: #555; margin-top: 5px; }
        .search-section { background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3; }
        .search-input { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; margin-bottom: 10px; }
        .search-results-info { color: #666; font-size: 14px; margin-bottom: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="/">ğŸ“… Dashboard</a>
        <a href="/history">ğŸ“Š History</a>
        <a href="/preview">ğŸ”® Preview</a>
        <a href="/practice">ğŸ¯ Practice</a>
        <a href="/analytics">ğŸ“ˆ Analytics</a>
        <a href="/config">âš™ï¸ Config</a>
        <a href="/help">â“ Help</a>
    </div>

    <div class="header">
        <h1>ğŸ“Š Progress History</h1>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-number">{{ total_topics }}</div>
            <div>Topics Completed</div>
        </div>
        <div class="stat">
            <div class="stat-number">{{ total_reviews }}</div>
            <div>Reviews Done</div>
        </div>
        <div class="stat">
            <div class="stat-number">{{ streak }}</div>
            <div>Day Streak</div>
        </div>
    </div>

    <div class="search-section">
        <h3>ğŸ” Search Your Learning History</h3>
        <input type="text" id="search-input" class="search-input" placeholder="Search topics, notes, or content (e.g., 'binary search', 'difficult', 'redis')...">
        <div id="search-results-info" class="search-results-info"></div>
    </div>

    <div class="section">
        <h2>ğŸ“š Recent Topic Completions</h2>
        {% if recent_completions %}
            {% for completion in recent_completions %}
            <div class="completion">
                <h4>{{ completion.track | title }}: {{ completion.topic }}</h4>
                <p><strong>Date:</strong> {{ completion.date }}</p>
                <p class="rating"><strong>Rating:</strong> {{ completion.rating }}/5</p>
                {% if completion.completed_on_time == true %}
                    <p><strong>Timer Status:</strong> <span style="color: #28a745; font-weight: bold;">â±ï¸ Completed On Time</span></p>
                {% elif completion.completed_on_time == false %}
                    <p><strong>Timer Status:</strong> <span style="color: #ffc107; font-weight: bold;">â±ï¸ Completed Over Time</span></p>
                {% endif %}
                {% if completion.notes %}
                <div class="notes">ğŸ’­ {{ completion.notes }}</div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>No completions yet. Start learning to see your progress here!</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>ğŸ”„ Recent Review Completions</h2>
        {% if completed_reviews %}
            {% for review in completed_reviews %}
            <div class="review-completion">
                <h4>{{ review.track | title }}: {{ review.topic }}</h4>
                <p><strong>Review Type:</strong> {{ review.review_type }}</p>
                <p><strong>Completed:</strong> {{ review.completed_date }}</p>
                <p><strong>Originally Learned:</strong> {{ review.scheduled_date }}</p>
                {% if review.rating %}
                <p class="rating"><strong>Recall Rating:</strong> {{ review.rating }}/5</p>
                {% endif %}
                {% if review.notes %}
                <div class="notes">ğŸ’­ {{ review.notes }}</div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>No reviews completed yet. Complete some topics first!</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>ğŸ¯ Quick Stats</h2>
        <p><strong>Total Learning Time:</strong> ~{{ (total_topics * 45) | int }} minutes</p>
        <p><strong>Total Review Time:</strong> ~{{ (total_reviews * 10) | int }} minutes</p>
        <p><strong>Average Rating:</strong>
            {% if recent_completions %}
                {{ "%.1f" | format((recent_completions | sum(attribute='rating')) / (recent_completions | length)) }}/5
            {% else %}
                N/A
            {% endif %}
        </p>
    </div>

    <script>
        // Search functionality
        const searchInput = document.getElementById('search-input');
        const searchResultsInfo = document.getElementById('search-results-info');
        let allCompletions = [];
        let allReviews = [];

        // Store all completion and review data for searching
        {% if recent_completions %}
        allCompletions = [
            {% for completion in recent_completions %}
            {
                element: document.querySelector('.completion:nth-of-type({{ loop.index }})'),
                track: '{{ completion.track }}',
                topic: '{{ completion.topic }}',
                date: '{{ completion.date }}',
                rating: {{ completion.rating }},
                notes: '{{ completion.notes or "" }}'
            },
            {% endfor %}
        ];
        {% endif %}

        {% if completed_reviews %}
        allReviews = [
            {% for review in completed_reviews %}
            {
                element: document.querySelector('.review-completion:nth-of-type({{ loop.index }})'),
                track: '{{ review.track }}',
                topic: '{{ review.topic }}',
                reviewType: '{{ review.review_type }}',
                completedDate: '{{ review.completed_date }}',
                scheduledDate: '{{ review.scheduled_date }}',
                rating: {{ review.rating or 0 }},
                notes: '{{ review.notes or "" }}'
            },
            {% endfor %}
        ];
        {% endif %}

        // Search function
        function performSearch(query) {
            const searchTerm = query.toLowerCase().trim();

            if (!searchTerm) {
                // Show all items
                allCompletions.forEach(item => {
                    if (item.element) item.element.classList.remove('hidden');
                });
                allReviews.forEach(item => {
                    if (item.element) item.element.classList.remove('hidden');
                });
                searchResultsInfo.textContent = '';
                return;
            }

            let visibleCompletions = 0;
            let visibleReviews = 0;

            // Filter completions
            allCompletions.forEach(item => {
                const matches = item.topic.toLowerCase().includes(searchTerm) ||
                               item.track.toLowerCase().includes(searchTerm) ||
                               item.notes.toLowerCase().includes(searchTerm) ||
                               item.date.includes(searchTerm) ||
                               item.rating.toString().includes(searchTerm);

                if (matches) {
                    if (item.element) item.element.classList.remove('hidden');
                    visibleCompletions++;
                } else {
                    if (item.element) item.element.classList.add('hidden');
                }
            });

            // Filter reviews
            allReviews.forEach(item => {
                const matches = item.topic.toLowerCase().includes(searchTerm) ||
                               item.track.toLowerCase().includes(searchTerm) ||
                               item.notes.toLowerCase().includes(searchTerm) ||
                               item.reviewType.toLowerCase().includes(searchTerm) ||
                               item.completedDate.includes(searchTerm) ||
                               item.rating.toString().includes(searchTerm);

                if (matches) {
                    if (item.element) item.element.classList.remove('hidden');
                    visibleReviews++;
                } else {
                    if (item.element) item.element.classList.add('hidden');
                }
            });

            // Update search results info
            const totalVisible = visibleCompletions + visibleReviews;
            searchResultsInfo.textContent = `Found ${totalVisible} items (${visibleCompletions} completions, ${visibleReviews} reviews) matching "${query}"`;
        }

        // Add event listener for real-time search
        searchInput.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });

        // Add keyboard shortcuts
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                searchInput.value = '';
                performSearch('');
                searchInput.blur();
            }
        });

        // Focus search on Ctrl+F or Cmd+F
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                searchInput.focus();
            }
        });
    </script>
</body>
</html>