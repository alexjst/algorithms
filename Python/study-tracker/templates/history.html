<!DOCTYPE html>
<html>
<head>
    <title>Study Tracker - History</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <style>
        /* Theme CSS Variables */
        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f9f9f9;
            --bg-header: #f0f8ff;
            --bg-stat: #f8f9fa;
            --bg-completion: #d4edda;
            --bg-review: #fff3cd;
            --bg-search: #e3f2fd;
            --text-primary: #212529;
            --text-secondary: #666;
            --text-tertiary: #555;
            --text-stat: #007bff;
            --border-color: #ddd;
            --border-light: #e1e5e9;
            --shadow: rgba(0, 0, 0, 0.08);
            --nav-hover: #f1f3f5;
            --nav-active-bg: #e7f3ff;
            --nav-active-color: #007bff;
            --nav-text: #495057;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --bg-header: #2c3e50;
            --bg-stat: #3a3a3a;
            --bg-completion: #2e5a3e;
            --bg-review: #4a4a2d;
            --bg-search: #2c3e50;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-tertiary: #999;
            --text-stat: #66b3ff;
            --border-color: #444;
            --border-light: #555;
            --shadow: rgba(0, 0, 0, 0.3);
            --nav-hover: #3a3a3a;
            --nav-active-bg: #1e3a5f;
            --nav-active-color: #66b3ff;
            --nav-text: #e0e0e0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .header { background: var(--bg-header); padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .section { border: 1px solid var(--border-color); padding: 15px; margin: 10px 0; border-radius: 5px; }
        .completion { background: var(--bg-completion); padding: 10px; margin: 5px 0; border-radius: 3px; }
        .review-completion { background: var(--bg-review); padding: 10px; margin: 5px 0; border-radius: 3px; }
        /* New Navigation Bar Styles */
        .nav-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Allows wrapping on very small screens */
            background-color: var(--bg-secondary);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow);
            margin-bottom: 30px;
        }
        .nav-link {
            display: flex; /* Aligns icon and text */
            align-items: center;
            white-space: nowrap; /* Prevents icon and text from breaking lines */
            text-decoration: none;
            color: var(--nav-text);
            padding: 10px 20px;
            margin: 5px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            background-color: var(--nav-hover);
            color: var(--nav-active-color);
        }
        .nav-link.active {
            background-color: var(--nav-active-bg);
            color: var(--nav-active-color);
            box-shadow: 0 2px 8px var(--shadow);
        }
        .theme-toggle {
            background: none;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .theme-toggle:hover {
            background-color: var(--nav-hover);
            transform: scale(1.05);
        }
        .stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat { background: var(--bg-stat); padding: 15px; border-radius: 5px; text-align: center; flex: 1; }
        .stat-number { font-size: 2em; font-weight: bold; color: var(--text-stat); }
        .rating { color: var(--text-secondary); }
        .notes { font-style: italic; color: var(--text-tertiary); margin-top: 5px; }
        .search-section { background: var(--bg-search); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3; }
        .search-input { width: 100%; padding: 12px; border: 2px solid var(--border-light); border-radius: 8px; font-size: 16px; margin-bottom: 10px; background: var(--bg-secondary); color: var(--text-primary); }
        .search-results-info { color: var(--text-secondary); font-size: 14px; margin-bottom: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Progress History</h1>
    </div>

    <!-- New Navigation Bar Structure -->
    <div class="nav-container">
        <a href="/" class="nav-link {% if active_page == 'dashboard' %}active{% endif %}" title="Go to Dashboard">üìÖ Dashboard</a>
        <a href="/history" class="nav-link {% if active_page == 'history' %}active{% endif %}" title="View Progress History">üìä History</a>
        <a href="/preview" class="nav-link {% if active_page == 'preview' %}active{% endif %}" title="See Upcoming Topics">üîÆ Preview</a>
        <a href="/practice" class="nav-link {% if active_page == 'practice' %}active{% endif %}" title="Practice & Mock Interviews">üéØ Practice</a>
        <a href="/analytics" class="nav-link {% if active_page == 'analytics' %}active{% endif %}" title="Analyze Your Performance">üìà Analytics</a>
        <a href="/curriculum" class="nav-link {% if active_page == 'curriculum' %}active{% endif %}" title="Edit the Curriculum">üìö Curriculum</a>
        <a href="/templates" class="nav-link {% if active_page == 'templates' %}active{% endif %}" title="Coding Patterns & Templates">üîß Templates</a>
        <a href="/config" class="nav-link {% if active_page == 'config' %}active{% endif %}" title="Configure Your Plan">‚öôÔ∏è Config</a>
        <a href="/help" class="nav-link {% if active_page == 'help' %}active{% endif %}" title="Get Help">‚ùì Help</a>
        <button class="theme-toggle" id="theme-toggle" title="Toggle Dark/Light Mode">üåô</button>
    </div>

    <div class="stats">
        <div class="stat">
            <div class="stat-number">{{ total_topics }}</div>
            <div>Topics Completed</div>
        </div>
        <div class="stat">
            <div class="stat-number">{{ total_reviews }}</div>
            <div>Reviews Done</div>
        </div>
        <div class="stat">
            <div class="stat-number">{{ streak }}</div>
            <div>Day Streak</div>
        </div>
    </div>

    <div class="search-section">
        <h3>üîç Search Your Learning History</h3>
        <input type="text" id="search-input" class="search-input" placeholder="Search topics, notes, or content (e.g., 'binary search', 'difficult', 'redis')...">
        <div id="search-results-info" class="search-results-info"></div>
    </div>

    <div class="section">
        <h2>üìö Recent Topic Completions</h2>
        {% if recent_completions %}
            {% for completion in recent_completions %}
            <div class="completion">
                <h4>{{ completion.track.replace('_', ' ') | title }}: {{ completion.topic }}</h4>
                <p><strong>Date:</strong> {{ completion.date }}</p>
                <p class="rating"><strong>Rating:</strong> {{ completion.rating }}/5</p>
                {% if completion.completed_on_time == true %}
                    <p><strong>Timer Status:</strong> <span style="color: #28a745; font-weight: bold;">‚è±Ô∏è Completed On Time</span></p>
                {% elif completion.completed_on_time == false %}
                    <p><strong>Timer Status:</strong> <span style="color: #ffc107; font-weight: bold;">‚è±Ô∏è Completed Over Time</span></p>
                {% endif %}
                {% if completion.notes %}
                <div class="notes">üí≠ {{ completion.notes }}</div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>No completions yet. Start learning to see your progress here!</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>üîÑ Recent Review Completions</h2>
        {% if completed_reviews %}
            {% for review in completed_reviews %}
            <div class="review-completion">
                <h4>{{ review.track.replace('_', ' ') | title }}: {{ review.topic }}</h4>
                <p><strong>Review Type:</strong> {{ review.review_type }}</p>
                <p><strong>Completed:</strong> {{ review.completed_date }}</p>
                <p><strong>Originally Learned:</strong> {{ review.scheduled_date }}</p>
                {% if review.rating %}
                <p class="rating"><strong>Recall Rating:</strong> {{ review.rating }}/5</p>
                {% endif %}
                {% if review.notes %}
                <div class="notes">üí≠ {{ review.notes }}</div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>No reviews completed yet. Complete some topics first!</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>üéØ Quick Stats</h2>
        <p><strong>Total Learning Time:</strong> ~{{ (total_topics * 45) | int }} minutes</p>
        <p><strong>Total Review Time:</strong> ~{{ (total_reviews * 10) | int }} minutes</p>
        <p><strong>Average Rating:</strong>
            {% if recent_completions %}
                {{ "%.1f" | format((recent_completions | sum(attribute='rating')) / (recent_completions | length)) }}/5
            {% else %}
                N/A
            {% endif %}
        </p>
    </div>

    <script>
        // Search functionality
        const searchInput = document.getElementById('search-input');
        const searchResultsInfo = document.getElementById('search-results-info');
        let allCompletions = [];
        let allReviews = [];

        // Store all completion and review data for searching
        {% if recent_completions %}
        allCompletions = [
            {% for completion in recent_completions %}
            {
                element: document.querySelector('.completion:nth-of-type({{ loop.index }})'),
                track: '{{ completion.track }}',
                topic: '{{ completion.topic }}',
                date: '{{ completion.date }}',
                rating: {{ completion.rating }},
                notes: '{{ completion.notes or "" }}'
            },
            {% endfor %}
        ];
        {% endif %}

        {% if completed_reviews %}
        allReviews = [
            {% for review in completed_reviews %}
            {
                element: document.querySelector('.review-completion:nth-of-type({{ loop.index }})'),
                track: '{{ review.track }}',
                topic: '{{ review.topic }}',
                reviewType: '{{ review.review_type }}',
                completedDate: '{{ review.completed_date }}',
                scheduledDate: '{{ review.scheduled_date }}',
                rating: {{ review.rating or 0 }},
                notes: '{{ review.notes or "" }}'
            },
            {% endfor %}
        ];
        {% endif %}

        // Search function
        function performSearch(query) {
            const searchTerm = query.toLowerCase().trim();

            if (!searchTerm) {
                // Show all items
                allCompletions.forEach(item => {
                    if (item.element) item.element.classList.remove('hidden');
                });
                allReviews.forEach(item => {
                    if (item.element) item.element.classList.remove('hidden');
                });
                searchResultsInfo.textContent = '';
                return;
            }

            let visibleCompletions = 0;
            let visibleReviews = 0;

            // Filter completions
            allCompletions.forEach(item => {
                const matches = item.topic.toLowerCase().includes(searchTerm) ||
                               item.track.toLowerCase().includes(searchTerm) ||
                               item.notes.toLowerCase().includes(searchTerm) ||
                               item.date.includes(searchTerm) ||
                               item.rating.toString().includes(searchTerm);

                if (matches) {
                    if (item.element) item.element.classList.remove('hidden');
                    visibleCompletions++;
                } else {
                    if (item.element) item.element.classList.add('hidden');
                }
            });

            // Filter reviews
            allReviews.forEach(item => {
                const matches = item.topic.toLowerCase().includes(searchTerm) ||
                               item.track.toLowerCase().includes(searchTerm) ||
                               item.notes.toLowerCase().includes(searchTerm) ||
                               item.reviewType.toLowerCase().includes(searchTerm) ||
                               item.completedDate.includes(searchTerm) ||
                               item.rating.toString().includes(searchTerm);

                if (matches) {
                    if (item.element) item.element.classList.remove('hidden');
                    visibleReviews++;
                } else {
                    if (item.element) item.element.classList.add('hidden');
                }
            });

            // Update search results info
            const totalVisible = visibleCompletions + visibleReviews;
            searchResultsInfo.textContent = `Found ${totalVisible} items (${visibleCompletions} completions, ${visibleReviews} reviews) matching "${query}"`;
        }

        // Add event listener for real-time search
        searchInput.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });

        // Add keyboard shortcuts
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                searchInput.value = '';
                performSearch('');
                searchInput.blur();
            }
        });

        // Focus search on Ctrl+F or Cmd+F
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                searchInput.focus();
            }
        });
    </script>

    <!-- Theme Toggle Functionality -->
    <script src="/static/theme.js"></script>
</body>
</html>